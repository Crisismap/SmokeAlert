<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<script src="spatial_query.js"></script>

    <link rel="stylesheet" href="../../geomixer/geomixer.css" />
    <script src="../../geomixer/geomixer-src.js"></script>
    
    <script src="../build/iconLayer.js"></script>
    <link rel="stylesheet" href="../css/iconLayers.css" />

    <link rel="stylesheet" href="../css/demo.css" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

	


	<title>Demo map Ecology</title>
</head>

<body>
		<div class="title_map">Мусорные бунты Подмосковья</div>
	<div id="map"></div>
	<div id="controls_date" class="controls_date">
		<div style="display:inline-flex; ">
            <div id="prev" class="prev_button"></div>
                <span id="timeInfo" style="padding: 4px 8px 0 12px"></span><span class="timeInfo2" style="padding: 4px 12px 0 8px"></span>
            <div id="next" class="next_button"></div>
        </div>
	</div>



	   <script>
        var map = L.map('map').setView([55.75, 37.61], 9);

        var osm = L.tileLayer('http://tile.stamen.com/toner/{z}/{x}/{y}.png ', {
            maxZoom: 18,
            attribution: 'Openstreetmap, Stamen, <a href="http://kosmosnimki.ru">Kosmosnimki.Ru</a>'
        }).addTo(map);
        
        var startDate = new Date();
        var oneDay = 1000*60*60*24,    // milliseconds in one day
            now = startDate.getTime(),
            ddt1 = new Date( now - now % oneDay + oneDay), //beginning of the previous UTC day
            ddt2 = new Date(ddt1.getTime() + oneDay); //beginning of the current UTC day

        var updateInfo = function(currentDate) {
            var zz = function(x) { return x < 10 ? "0" + x : x}
            var dateStr = zz(currentDate.getUTCDate()) + '.' + zz(currentDate.getUTCMonth() + 1) + '.' + zz(currentDate.getUTCFullYear());
            document.getElementById('timeInfo').innerHTML = dateStr;
        }
        
        updateInfo(ddt1);
        
        L.gmx.loadLayers([
            //{mapID: '1D30C72D02914C5FB90D1D448159CAB6', layerID: 'C9458F2DCB754CEEACC54216C7D1EB0A'},
			{mapID: 'ED63F94E015B402684AC0C7AD2DEDED8', layerID: '535B6107967442AEAE705D7FA23D85BD'},
            {mapID: 'ED63F94E015B402684AC0C7AD2DEDED8', layerID: '8AAD13BFD26E48C78DB22242AF7A3BBC'},
            {mapID: 'ED63F94E015B402684AC0C7AD2DEDED8', layerID: '66583812E539452E9A4C0BC68609DD66'}
        ]).then(function(region, landfill, news) {
            news.setDateInterval(ddt1, ddt2);
            news.addTo(map);
            region.addTo(map);
            landfill.addTo(map);
            
            L.control.layers({
            }, {
                "Новости": news,
                "Полигоны ТБО": landfill
           }, {collapsed: false}).addTo(map);

           news.bindClusters();
            
            //controls
            document.getElementById("prev").onclick = function() {
                ddt1 = new Date(ddt1.getTime() - oneDay);
                ddt2 = new Date(ddt2.getTime() - oneDay);
                news.setDateInterval(ddt1, ddt2);
                updateInfo(ddt1);
            }
            
            document.getElementById("next").onclick = function() {
                ddt1 = new Date(ddt1.getTime() + oneDay);
                ddt2 = new Date(ddt2.getTime() + oneDay);
                news.setDateInterval(ddt1, ddt2);
                updateInfo(ddt1);
            }
            
            /*var IsDayIndex = modisLayer._gmx.tileAttributeIndexes.IsDay;
            document.getElementById("dayFilter").onclick = function() {
                modisLayer.setFilter(function(item) {
                    return item.properties[IsDayIndex];
                });
            }
            
            document.getElementById("nightFilter").onclick = function() {
                modisLayer.setFilter(function(item) {
                    return !item.properties[IsDayIndex];
                });
            }
            
            document.getElementById("noneFilter").onclick = function() {
                modisLayer.setFilter(null);
            }*/
        })
    </script>


</body>
</html>
